{"version":3,"sources":["../lib/jwt.ts"],"sourcesContent":["import jsonwebtoken from \"jsonwebtoken\"\n\n\nconst API_TOKEN_TTL_SECONDS = 3 * 60\n\n// const CACHE_TTL_SECONDS = API_TOKEN_TTL_SECONDS - 30\n\nexport const generateToken = (apiKey: string) => {\n    try {\n        const [api_key, secret] = apiKey.split(\".\")\n        const payload = {\n            \"api_key\": api_key,\n            \"exp\": Math.round(Date.now() * 1000) + API_TOKEN_TTL_SECONDS * 1000,\n            \"timestamp\": Math.round(Date.now() * 1000),\n        }\n        // algorithm = \"HS256\", headers = { \"alg\": \"HS256\", \"sign_type\": \"SIGN\" }\n        //@ts-ignore 不用管\n        const ret = jsonwebtoken.sign(payload, secret, {\n            algorithm: \"HS256\",\n            header: { alg: \"HS256\", sign_type: \"SIGN\" }\n        })\n        return ret\n    } catch (e) {\n        throw \"invalid api_key\"\n    }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAyB;AAGzB,IAAM,wBAAwB,IAAI;AAI3B,IAAM,gBAAgB,CAAC,WAAmB;AAC7C,MAAI;AACA,UAAM,CAAC,SAAS,MAAM,IAAI,OAAO,MAAM,GAAG;AAC1C,UAAM,UAAU;AAAA,MACZ,WAAW;AAAA,MACX,OAAO,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI,IAAI,wBAAwB;AAAA,MAC/D,aAAa,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI;AAAA,IAC7C;AAGA,UAAM,MAAM,oBAAAA,QAAa,KAAK,SAAS,QAAQ;AAAA,MAC3C,WAAW;AAAA,MACX,QAAQ,EAAE,KAAK,SAAS,WAAW,OAAO;AAAA,IAC9C,CAAC;AACD,WAAO;AAAA,EACX,SAAS,GAAG;AACR,UAAM;AAAA,EACV;AACJ;","names":["jsonwebtoken"]}